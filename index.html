<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>앱 설치 안내</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f0f0;
            color: #333;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: #007bff;
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-bottom: 20px;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            margin: 10px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        #contentSection {
            background-color: white;
            border-radius: 5px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>FLO 앱을 설치해주세요</h1>
    </div>
    <div class="container">
        <p>더 나은 경험을 위해 앱을 설치해 주세요.</p>
        <div id="appButtons">
            <a href="#" id="installAndroid" class="btn" style="display: none;">Android 앱 설치</a>
            <a href="#" id="installIOS" class="btn" style="display: none;">iOS 앱 설치</a>
            <a href="#" id="landingUrl" class="btn">아티스트 바로가기</a>
        </div>
        <div id="contentSection">
            <h2>공유된 콘텐츠</h2>
            <div id="loader" class="loader"></div>
            <p id="sharedContent" style="display: none;"></p>
        </div>
    </div>

    <script>
        var inappdeny_exec_vanillajs = (callback) => {
		if(document.readyState !== 'loading'){
			callback();
		}else{
			document.addEventListener('DOMContentLoaded', callback);
		} 
	}
	inappdeny_exec_vanillajs(() => { 
		/* Do things after DOM has fully loaded */ 
		function copytoclipboard(val){
			var t = document.createElement("textarea");
			document.body.appendChild(t);
			t.value = val;
			t.select();
			document.execCommand('copy');
			document.body.removeChild(t);
		};
		function inappbrowserout(){
			copytoclipboard(window.location.href);
			alert('URL주소가 복사되었습니다.\n\nSafari가 열리면 주소창을 길게 터치한 뒤, "붙여놓기 및 이동"를 누르면 정상적으로 이용하실 수 있습니다.');
			location.href='x-web-search://?';
		};
		var useragt = navigator.userAgent.toLowerCase();
		var target_url = "https://flomuz.io/s/e.BwRUA";

		if(useragt.match(/kakaotalk/i)){
			//카카오톡 외부브라우저로 호출
			location.href = 'kakaotalk://web/openExternal?url='+encodeURIComponent(target_url);
		}else if(useragt.match(/line/i)){
			//라인 외부브라우저로 호출
			if(target_url.indexOf('?') !== -1){
				location.href = target_url+'&openExternalBrowser=1';
			}else{
				location.href = target_url+'?openExternalBrowser=1';
			}
		}else if(useragt.match(/inapp|naver|snapchat|wirtschaftswoche|thunderbird|instagram|everytimeapp|whatsApp|electron|wadiz|aliapp|zumapp|iphone(.*)whale|android(.*)whale|kakaostory|band|twitter|DaumApps|DaumDevice\/mobile|FB_IAB|FB4A|FBAN|FBIOS|FBSS|trill|SamsungBrowser\/[^1]/i)){
			//그외 다른 인앱들
			if(useragt.match(/iphone|ipad|ipod/i)){
				//아이폰은 강제로 사파리를 실행할 수 없다 ㅠㅠ
				//모바일대응뷰포트강제설정
				var mobile = document.createElement('meta');
				mobile.name = 'viewport';
				mobile.content = "width=device-width, initial-scale=1, shrink-to-fit=no, user-scalable=no, minimal-ui";
				document.getElementsByTagName('head')[0].appendChild(mobile);
				//노토산스폰트강제설정
				var fonts = document.createElement('link');
				fonts.href = 'https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100;300;400;500;700;900&display=swap';
				document.getElementsByTagName('head')[0].appendChild(fonts);
				document.body.innerHTML = "<style>body{margin:0;padding:0;font-family: 'Noto Sans KR', sans-serif;overflow: hidden;height: 100%;}</style><h2 style='padding-top:50px; text-align:center;font-family: 'Noto Sans KR', sans-serif;'>인앱브라우저 호환문제로 인해<br />Safari로 접속해야합니다.</h2><article style='text-align:center; font-size:17px; word-break:keep-all;color:#999;'>아래 버튼을 눌러 Safari를 실행해주세요<br />Safari가 열리면, 주소창을 길게 터치한 뒤,<br />'붙여놓기 및 이동'을 누르면<br />정상적으로 이용할 수 있습니다.<br /><br /><button onclick='inappbrowserout();' style='min-width:180px;margin-top:10px;height:54px;font-weight: 700;background-color:#31408E;color:#fff;border-radius: 4px;font-size:17px;border:0;'>Safari로 열기</button></article><img style='width:70%;margin:50px 15% 0 15%' src='https://tistory3.daumcdn.net/tistory/1893869/skin/images/inappbrowserout.jpeg' />";

                location.href = target_url

			}else{
				//안드로이드는 Chrome이 설치되어있음으로 강제로 스킴실행한다.
				location.href='intent://'+target_url.replace(/https?:\/\//i,'')+'#Intent;scheme=http;package=com.android.chrome;end';
			}
		}
	});

        // URL에서 파라미터 추출
        const urlParams = new URLSearchParams(window.location.search);
        const screenId = urlParams.get('screenId');

        // 사용자 기기 감지
        function detectUserAgent() {
            const userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/android/i.test(userAgent)) {
                document.getElementById('installAndroid').style.display = 'inline-block';
            } else if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                document.getElementById('installIOS').style.display = 'inline-block';
            } else {
                document.getElementById('installAndroid').style.display = 'inline-block';
                document.getElementById('installIOS').style.display = 'inline-block';
            }
            // document.getElementById('landingUrl').style.display = 'inline-block';
        }

        // 앱 스토어 링크 설정
        document.getElementById('installAndroid').href = 'https://play.google.com/store/apps/details?id=skplanet.musicmate';
        document.getElementById('installIOS').href = 'https://apps.apple.com/app/id1129048043';
        document.getElementById('landingUrl').href = 'https://flomuz.io/s/e.BwRUA';

        // 공유된 콘텐츠 표시
        function fetchSharedContent(id) {
            // 실제 구현에서는 서버 API를 호출하여 데이터를 가져옵니다.
            // 여기서는 예시로 setTimeout을 사용하여 비동기 작업을 시뮬레이션합니다.
            setTimeout(() => {
                document.getElementById('loader').style.display = 'none';
                document.getElementById('sharedContent').style.display = 'block';
                document.getElementById('sharedContent').textContent = `스크린 ID ${id}에 해당하는 콘텐츠입니다. 앱에서 더 자세한 정보를 확인하세요.`;
            }, 2000);
        }

        // 초기화
        detectUserAgent();
        if (screenId) {
            fetchSharedContent(screenId);
        } else {
            document.getElementById('loader').style.display = 'none';
            document.getElementById('sharedContent').style.display = 'block';
            document.getElementById('sharedContent').textContent = '공유된 콘텐츠 정보를 찾을 수 없습니다.';
        }
    </script>
</body>
</html>